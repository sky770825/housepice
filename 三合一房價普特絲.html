<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="UTF-8" />
  <!-- âœ… è‡ªå‹•èª¿ç¯€ç¸®æ”¾ã€iOS ç€æµ·å®‰å…¨å€ -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>ğŸ  æˆ¿ç”¢è²»ç”¨æ™ºæ…§ä¼°ç®—ä¸­å¿ƒ + ğŸªŸ æ™®ç‰¹çµ²ä¼°åƒ¹ï¼ˆæ•´åˆç‰ˆï¼‰</title>

  <!-- åœ–ç¤ºå­—å‹ï¼šBootstrap Icons + Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">

  <style>
    /* ----------------------------------------------------------
       Bootswatch-likeï¼ˆå­é›†ï¼‰ä¸»é¡Œ + RWD/ç©©å®šæ»‘å‹•/ä¸æ›è¡Œå„ªåŒ–
       ---------------------------------------------------------- */
    :root{
      --base-fz: clamp(14px, 1.6vw, 17px);
      --brand-1:#0abf9e;   /* ç¶ æ¾çŸ³ */
      --brand-2:#ffb703;   /* æš–é»ƒ */
      --brand-3:#f17b5f;   /* æ©˜ç´… */
      --brand-4:#36a2eb;   /* è— */
      --bg-1:#fdfcf8;
      --text-1:#24323f;
      --muted:#6b7a86;
      --card:#ffffff;
      --ring:#9debdc;
      --container-max: 1200px;
    }

    html{ font-size: var(--base-fz); -webkit-text-size-adjust: 100%; }
    body{
      font-family: "Microsoft JhengHei","Noto Sans TC",system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"PingFang TC","Heiti TC","å„·é»‘ Pro",sans-serif;
      color: var(--text-1);
      background: radial-gradient(1200px 800px at 10% -10%, #e7fff7 0%, transparent 60%),
                  radial-gradient(1200px 800px at 110% 10%, #fff6d8 0%, transparent 60%),
                  var(--bg-1);
      line-height: 1.5;
      /* âœ… å›ºå®šæ¡†æ¶ï¼‹ç©©å®šæ»‘å‹• */
      overflow-y: scroll;
      overscroll-behavior: contain;
      -webkit-overflow-scrolling: touch;
      margin: 0;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
    }

    /* âœ… ç›’æ¨¡å‹ï¼è¼¸å…¥å…ƒä»¶ä¸è¶…å‡ºå®¹å™¨ï¼ˆè¦ç¯„å¿…è¦ï¼‰ */
    * { box-sizing: border-box; }
    input, select, textarea { max-width: 100%; font-size: 16px; } /* 16px é˜² iOS èšç„¦æ”¾å¤§ */

    .container{ max-width: var(--container-max); margin: 0 auto; padding: 20px clamp(12px, 4vw, 24px); }

    .page-title{ text-align:center; margin-bottom: 18px; }
    .page-title h1{
      font-size: clamp(22px, 4.2vw, 40px);
      margin: 8px 0 6px; font-weight: 800;
      display:flex; align-items:center; justify-content:center; gap:12px;
      letter-spacing: .5px;
    }
    .page-title p{ color: var(--muted); font-size: clamp(13px, 1.8vw, 16px); }

    /* ä¸‰åˆ†é åˆ‡æ›å™¨ */
    .switcher{
      display:flex; gap: 8px; justify-content:center; margin: 12px 0 22px;
      background: #fff; padding: 8px; border-radius: 12px; box-shadow: 0 6px 24px rgba(0,0,0,.06);
      flex-wrap: wrap;
    }
    .btn{
      border: none; padding: clamp(10px, 2.2vw, 12px) clamp(14px, 3vw, 18px); border-radius: 10px; cursor: pointer; font-weight: 700;
      transition: .2s ease; display: inline-flex; align-items:center; gap: 8px;
      white-space: nowrap;
    }
    .btn:focus{ outline: 3px solid var(--ring); outline-offset: 2px; }
    .btn-ghost{ background: transparent; color: var(--muted); }
    .btn-ghost:hover{ background: #f2f4f6; color: var(--text-1); }
    .btn-green{ background: var(--brand-1); color: #fff; }
    .btn-green:hover{ filter: brightness(.95); transform: translateY(-1px); }
    .btn-blue{ background: var(--brand-4); color:#fff; }
    .btn-blue:hover{ filter: brightness(.95); transform: translateY(-1px); }
    .btn-orange{ background: var(--brand-2); color:#7a4c00; }
    .btn-orange:hover{ filter: brightness(.95); transform: translateY(-1px); }
    .btn-gray{ background: #768a9a; color: #fff; }
    .btn-gray:hover{ filter: brightness(.95); }

    .grid{ display: grid; gap: 16px; grid-template-columns: 1fr; }
    @media (min-width: 992px){ .grid{ grid-template-columns: 1fr 1fr; } }

    .card{
      background: var(--card); border-radius: 16px; padding: clamp(16px, 3.4vw, 20px);
      box-shadow: 0 10px 30px rgba(0,0,0,.06);
    }
    .card h2{ font-size: clamp(18px, 2.6vw, 22px); font-weight: 800; margin: 0 0 6px; display:flex; align-items:center; gap:10px; }
    .subtle{ color: var(--muted); margin-bottom: 12px; font-size: clamp(13px,1.8vw,15px); }

    /* è¡¨å–® */
    .form-row{ display: grid; gap: 12px; grid-template-columns: 1fr; margin-bottom: 12px; }
    @media (min-width: 600px){ .form-row.cols-2{ grid-template-columns: 1fr 1fr; } }
    .form-group label{ display:block; font-size: 14px; color: #415363; margin-bottom: 6px; font-weight: 600; }
    .input, .select{
      width: 100%; padding: 12px 14px; border: 1px solid #d8e2ea; border-radius: 10px;
      outline: none; transition: .15s border, .15s box-shadow; background: #fff;
    }
    .input:focus, .select:focus{ border-color: var(--brand-1); box-shadow: 0 0 0 4px #d6faf1; }

    .section-toggle{
      width: 100%; border-radius: 10px; padding: 10px 14px; text-align: left;
      background: #fff6d8; color: #7a4c00; border: 1px solid #ffe6a7;
      font-weight: 700;
    }
    .toggle-panel{ margin-top: 12px; background:#f6fafb; border:1px dashed #d1e8ef; padding:14px; border-radius:12px; }

    /* çµæœé‡é»æ•¸å­—ï¼ˆç½®ä¸­ã€è¶…å¤§ã€ç²—é«”ï¼‹ä¸åŒè‰²ï¼‰ */
    .hero-number{ font-size: clamp(26px, 6.2vw, 48px); font-weight: 900; color: var(--brand-1); text-shadow: 0 2px 0 rgba(0,0,0,.05); }
    .hero-number.blue{ color: var(--brand-4); }
    .hero-note{ color: #3b4a57; opacity: .9; font-size: clamp(13px,1.8vw,15px); }
    .badge{
      display:inline-block; padding: 4px 10px; border-radius: 999px; font-size: 12px; font-weight: 700;
      background: #e8fff9; color:#0f6b5b; border:1px solid #b9f5e9;
    }

    .kpi-grid{ display:grid; gap:12px; grid-template-columns: 1fr; }
    @media (min-width: 700px){ .kpi-grid{ grid-template-columns: 1fr 1fr; } }
    .kpi{ background:#f8fbfd; border:1px solid #e5eef5; border-radius: 12px; padding: 12px; }
    .kpi .label{ color:#6c7c89; font-size: 13px; }
    .kpi .value{ font-weight: 800; font-size: clamp(16px, 2vw, 20px); }

    /* CTAï¼šå®˜æ–¹å¸³è™Ÿä¸€è¡Œé¡¯ç¤ºã€ä¸æ›è¡Œã€å¯æ°´å¹³æ»‘å‹•ï¼ˆå›ºå®šåœ¨æ¯é åº•éƒ¨ï¼‰ */
    .cta{ margin:18px auto 26px; text-align:center; overflow-x: auto; -webkit-overflow-scrolling: touch; }
    .cta a{
      display:inline-flex; align-items:center; gap:10px; padding: 14px 18px;
      background: var(--brand-1); color:#fff; border-radius:12px; font-weight:800;
      box-shadow: 0 10px 24px rgba(10,191,158,.25);
      transition: .2s; transform: translateZ(0);
      white-space: nowrap; width: max-content;
      font-size: clamp(12px, 1.8vw, 16px); text-decoration: none;
    }
    .cta a:hover{ filter: brightness(.95); transform: translateY(-1px); }
    .cta .subtle{ margin-top:6px; color:#666; font-size:14px; }

    /* æº«é¦¨æé†’ */
    .note{ background:#fff8e8; border:1px solid #ffe3a9; border-radius:14px; padding:16px; margin-top:20px; }
    .note h3{ margin:0 0 8px; }
    .note ul{ margin:0; padding-left: 1em; color:#7a5b00; }

    .hidden{ display:none !important; }

    /* ====== æ™®ç‰¹çµ²ç´—çª—å·¥å…·çš„æ¨£å¼è£œå¼·ï¼ˆèˆ‡ä¸»é¡Œèåˆï¼‰ ====== */
    .toolbar{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:14px;}
    @media(min-width:640px){.toolbar{grid-template-columns:repeat(4,1fr);}}
    .btn.dark{background:#2a9d8f;color:#fff;}
    .btn.warn{background:#ffb3b3;}
    .btn.secondary{background:#ffd88f;}
    .btn.copy{background:#78C2AD;color:#0b2e2a;margin-bottom:10px;}
    .table-wrap{overflow-x:auto;border:1px solid #e6efec;border-radius:14px;}
    table{width:100%;min-width:720px;border-collapse:separate;border-spacing:0;}
    thead th{background:#f2fbf7;padding:10px;}
    tbody td{padding:8px;border-bottom:1px dashed #ddd;}
    select,input{padding:6px;border:1px solid #ccc;border-radius:8px;}
    .quoteText{margin-top:10px;padding:14px;border:1px dashed #aaa;white-space:pre-line;background:#f7f7f7;}
  </style>
</head>
<body>
  <div class="container" id="app">
    <!-- æ¨™é¡Œå€ -->
    <div class="page-title">
      <h1><i class="bi bi-house-heart-fill" style="color:#ff7b54"></i> æˆ¿ç”¢/æ™®ç‰¹çµ²æ™ºæ…§ä¼°ç®—ä¸­å¿ƒ</h1>
      <p>è²·æ–¹ã€è³£æ–¹èˆ‡ç´—çª—å ±åƒ¹ï¼Œä¸€é å®Œæˆ</p>
    </div>

    <!-- ä¸‰åˆ†é åˆ‡æ› -->
    <div class="switcher" role="tablist" aria-label="æ¨¡å¼åˆ‡æ›">
      <button id="btnTabBuyer" class="btn btn-green" aria-selected="true"><i class="bi bi-calculator"></i> æˆ‘æ˜¯è²·æ–¹</button>
      <button id="btnTabSeller" class="btn btn-blue" aria-selected="false"><i class="bi bi-graph-up-arrow"></i> æˆ‘æ˜¯è³£æ–¹</button>
      <button id="btnTabScreen" class="btn btn-orange" aria-selected="false"><i class="bi bi-window"></i> æ™®ç‰¹çµ²ä¼°åƒ¹</button>
    </div>

    <!-- ====== åˆ†é  1ï¼šè²·æ–¹ ====== -->
    <div id="tabBuyer">
      <div class="grid">
        <section class="card" id="cardInputsBuyer" aria-labelledby="formTitleBuyer">
          <h2 id="formTitleBuyer"><i class="bi bi-calculator-fill" style="color:var(--brand-1)"></i> è²·æ–¹è²»ç”¨ä¼°ç®—</h2>
          <p class="subtle">è¨ˆç®—è³¼å±‹æ‰€éœ€çš„ç¸½è‡ªå‚™æ¬¾èˆ‡ç›¸é—œè²»ç”¨</p>

          <!-- è²·æ–¹è¡¨å–®ï¼ˆæˆæ•¸ 30-85 / å¹´æœŸ 0-40 / å¯¬é™ 0-5ï¼‰ -->
          <form id="formBuyer">
            <div class="form-row">
              <div class="form-group">
                <label>æˆ¿å±‹ç¸½åƒ¹ï¼ˆè¬å…ƒï¼‰</label>
                <input id="bHousePrice" type="number" class="input" placeholder="è«‹è¼¸å…¥æˆ¿å±‹ç¸½åƒ¹ï¼ˆè¬å…ƒï¼‰">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>è²¸æ¬¾æˆæ•¸ï¼ˆ30 ~ 85ï¼‰</label>
                <input id="bLoanRatio" type="number" class="input" min="30" max="85" value="80">
              </div>
            </div>

            <div class="form-row cols-2">
              <div class="form-group">
                <label>è²¸æ¬¾å¹´æœŸï¼ˆ0 ~ 40 å¹´ï¼‰</label>
                <input id="bLoanYears" type="number" class="input" min="0" max="40" value="30">
              </div>
              <div class="form-group">
                <label>å¹´åˆ©ç‡ï¼ˆ%ï¼‰</label>
                <input id="bInterest" type="number" step="0.1" class="input" value="2.1">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>å¯¬é™æœŸï¼ˆ0 ~ 5 å¹´ï¼‰</label>
                <input id="bGraceYears" type="number" class="input" min="0" max="5" value="0">
              </div>
            </div>

            <!-- é›œè²»ï¼ˆå¯é¸ï¼‰ -->
            <button class="section-toggle" type="button" data-target="#buyerMisc">é›œé …è²»ç”¨ï¼ˆå¯é¸å¡«ï¼‰</button>
            <div id="buyerMisc" class="toggle-panel hidden">
              <div class="form-row cols-2">
                <div class="form-group"><label>æœå‹™è²»ï¼ˆNT$ï¼‰</label><input id="bServiceFee" type="number" class="input"></div>
                <div class="form-group"><label>ä»£æ›¸è²»ï¼ˆNT$ï¼‰</label><input id="bNotaryFee" type="number" class="input"></div>
                <div class="form-group"><label>ä»²ä»‹è²»ï¼ˆNT$ï¼‰</label><input id="bAgentFee" type="number" class="input"></div>
                <div class="form-group"><label>å¥‘ç¨…ï¼ˆNT$ï¼‰</label><input id="bContractTax" type="number" class="input"></div>
                <div class="form-group"><label>åœ°æ”¿è¦è²»ï¼ˆNT$ï¼‰</label><input id="bRegFee" type="number" class="input"></div>
                <div class="form-group"><label>ç«éšª/åœ°éœ‡éšªï¼ˆNT$ï¼‰</label><input id="bInsurance" type="number" class="input"></div>
              </div>
            </div>

            <!-- å‹•ä½œæŒ‰éˆ• -->
            <div style="display:flex; gap:10px; margin-top: 12px;">
              <button type="button" id="btnCalcBuyer" class="btn btn-green" style="flex:1"><i class="bi bi-play-fill"></i> é–‹å§‹ä¼°ç®—</button>
              <button type="button" id="btnClearBuyer" class="btn btn-gray" style="flex:1"><i class="bi bi-arrow-counterclockwise"></i> æ¸…é™¤é‡å¡«</button>
            </div>
          </form>
        </section>

        <!-- çµæœå¡ç‰‡ï¼ˆè²·æ–¹ï¼‰ -->
        <section class="card" id="cardResultsBuyer">
          <h2><i class="bi bi-stars" style="color:var(--brand-2)"></i> æ‚¨çš„ä¼°ç®—çµæœ</h2>
          <div id="placeholderBuyer" class="subtle" style="text-align:center; padding: 26px 6px;">
            <i class="bi bi-calculator" style="font-size:56px; opacity:.35;"></i>
            <p>è«‹å¡«å¯«å·¦å´è³‡è¨Šä¸¦é»æ“Šã€Œé–‹å§‹ä¼°ç®—ã€</p>
          </div>

          <div id="buyerResults" class="hidden">
            <div class="kpi" style="text-align:center; background: linear-gradient(180deg,#e8fff9,#ffffff 60%); border-color:#c8f3e9;">
              <div class="label">ç¸½è‡ªå‚™æ¬¾</div>
              <div class="hero-number">NT$ <span id="bHeroDown">-</span> å…ƒ</div>
              <div class="hero-note">è²¸æ¬¾é‡‘é¡ï¼šNT$ <strong id="bHeroLoan">-</strong> å…ƒ</div>
            </div>

            <!-- æ˜ç´°å¡ -->
            <div class="kpi-grid" id="bDetailGrid"></div>
          </div>
        </section>
      </div>

      <!-- æº«é¦¨æé†’ -->
      <div class="note">
        <h3><i class="bi bi-lightbulb-fill" style="color:#e6a200"></i> æº«é¦¨æé†’</h3>
        <ul>
          <li>ä»¥ä¸Šç‚ºè©¦ç®—çµæœï¼Œå¯¦éš›è²¸æ¬¾æ¢ä»¶èˆ‡åˆ©ç‡ä»é ˆä»¥å„å®¶éŠ€è¡Œå¯©æ ¸ç‚ºæº–ã€‚</li>
          <li>æˆ¿å±‹ç¨…ã€åœ°åƒ¹ç¨…ã€ç®¡ç†è²»ç­‰æŒæœ‰æˆæœ¬æœªåˆ—å…¥è¨ˆç®—ï¼Œè«‹ä¸€ä½µè€ƒé‡ã€‚</li>
          <li>æˆ¿åœ°åˆä¸€ç¨…è¨ˆç®—åƒ…ä¾›åƒè€ƒï¼Œå¯¦éš›ç¨…é¡è«‹æ´½è©¢ç¨…å‹™å°ˆæ¥­äººå£«ã€‚</li>
        </ul>
      </div>
    </div>

    <!-- ====== åˆ†é  2ï¼šè³£æ–¹ ====== -->
    <div id="tabSeller" class="hidden">
      <div class="grid">
        <section class="card" id="cardInputsSeller" aria-labelledby="formTitleSeller">
          <h2 id="formTitleSeller"><i class="bi bi-cash-coin" style="color:var(--brand-4)"></i> è³£æ–¹è²»ç”¨ä¼°ç®—</h2>
          <p class="subtle">è¨ˆç®—å”®å±‹æ‰€éœ€çš„ç¸½æ”¯å‡ºèˆ‡ç›¸é—œè²»ç”¨</p>

          <!-- è³£æ–¹è¡¨å–® -->
          <form id="formSeller">
            <div class="form-row">
              <div class="form-group">
                <label>æˆ¿å±‹æˆäº¤ç¸½åƒ¹ï¼ˆè¬å…ƒï¼‰</label>
                <input id="sSalePrice" type="number" class="input" placeholder="è«‹è¼¸å…¥æˆäº¤ç¸½åƒ¹ï¼ˆè¬å…ƒï¼‰">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label>ç•¶åˆè³¼è²·ç¸½åƒ¹ï¼ˆè¬å…ƒï¼‰</label>
                <input id="sPurchasePrice" type="number" class="input" placeholder="è«‹è¼¸å…¥è³¼è²·ç¸½åƒ¹ï¼ˆè¬å…ƒï¼‰">
              </div>
            </div>

            <div class="form-row cols-2">
              <div class="form-group">
                <label>å–å¾—æ—¥æœŸ</label>
                <input id="sPurchaseDate" type="date" class="input">
              </div>
              <div class="form-group">
                <label>è½‰ç§»æ—¥æœŸ</label>
                <input id="sSaleDate" type="date" class="input">
              </div>
            </div>

            <!-- è‡ªä½å„ªæƒ æ¢ä»¶ -->
            <div class="toggle-panel" style="background:#eef8ff; border-color:#cfe7ff">
              <strong class="badge"><i class="fa-solid fa-house-chimney"></i> è‡ªä½å„ªæƒ æ¢ä»¶</strong>
              <div class="form-row">
                <label><input id="sOwner" type="checkbox"> ç‚ºæœ¬äººï¼é…å¶ï¼æœªæˆå¹´å­å¥³è‡ªä½</label>
                <label><input id="sResidence" type="checkbox"> è¨­ç±ä¸”é€£çºŒæŒæœ‰æ»¿ 6 å¹´</label>
                <label><input id="sRented" type="checkbox"> äº¤æ˜“å‰ 6 å¹´å…§æ›¾å‡ºç§Ÿæˆ–åšç‡Ÿæ¥­ä½¿ç”¨ï¼ˆè‹¥æœ‰è«‹æ‰“å‹¾ï¼‰</label>
              </div>
            </div>

            <div class="form-row cols-2">
              <div class="form-group">
                <label>æ”¹è‰¯è²»ç”¨ï¼ˆNT$ï¼‰</label>
                <input id="sImprove" type="number" class="input" placeholder="è£ä¿®ç­‰è²»ç”¨">
              </div>
              <div class="form-group">
                <label>åœŸåœ°æ¼²åƒ¹ç¸½æ•¸é¡ï¼ˆNT$ï¼‰</label>
                <input id="sLVI" type="number" class="input" placeholder="ç”±æ©Ÿé—œæä¾›">
              </div>
            </div>

            <!-- é›œè²»ï¼ˆå¯é¸ï¼‰ -->
            <button class="section-toggle" type="button" data-target="#sellerMisc">é›œé …è²»ç”¨ï¼ˆå¯é¸å¡«ï¼‰</button>
            <div id="sellerMisc" class="toggle-panel hidden">
              <div class="form-row cols-2">
                <div class="form-group"><label>ä»²ä»‹æœå‹™è²»ç‡ï¼ˆ%ï¼‰</label><input id="sAgentRate" type="number" step="0.1" class="input" value="2"></div>
                <div class="form-group"><label>ä»£æ›¸è²»ï¼ˆNT$ï¼‰</label><input id="sNotary" type="number" class="input" value="15000"></div>
                <div class="form-group"><label>å¥‘ç¨…ï¼ˆNT$ï¼‰</label><input id="sContract" type="number" class="input"></div>
                <div class="form-group"><label>å°èŠ±ç¨…ï¼ˆNT$ï¼‰</label><input id="sStamp" type="number" class="input"></div>
                <div class="form-group"><label>å…¬è­‰è²»ï¼ˆNT$ï¼‰</label><input id="sCert" type="number" class="input"></div>
                <div class="form-group"><label>æˆ¿è²¸æ¸…å„Ÿé¤˜é¡ï¼ˆNT$ï¼‰</label><input id="sPayoff" type="number" class="input"></div>
                <div class="form-group"><label>å…¶ä»–è²»ç”¨ï¼ˆNT$ï¼‰</label><input id="sOther" type="number" class="input"></div>
              </div>
            </div>

            <!-- å‹•ä½œæŒ‰éˆ• -->
            <div style="display:flex; gap:10px; margin-top: 12px;">
              <button type="button" id="btnCalcSeller" class="btn btn-blue" style="flex:1"><i class="bi bi-play-fill"></i> é–‹å§‹ä¼°ç®—</button>
              <button type="button" id="btnClearSeller" class="btn btn-gray" style="flex:1"><i class="bi bi-arrow-counterclockwise"></i> æ¸…é™¤é‡å¡«</button>
            </div>
          </form>
        </section>

        <!-- çµæœå¡ç‰‡ï¼ˆè³£æ–¹ï¼‰ -->
        <section class="card" id="cardResultsSeller">
          <h2><i class="bi bi-stars" style="color:var(--brand-2)"></i> æ‚¨çš„ä¼°ç®—çµæœ</h2>
          <div id="placeholderSeller" class="subtle" style="text-align:center; padding: 26px 6px;">
            <i class="bi bi-calculator" style="font-size:56px; opacity:.35;"></i>
            <p>è«‹å¡«å¯«å·¦å´è³‡è¨Šä¸¦é»æ“Šã€Œé–‹å§‹ä¼°ç®—ã€</p>
          </div>

          <div id="sellerResults" class="hidden">
            <div class="kpi" style="text-align:center; background: linear-gradient(180deg,#eef6ff,#ffffff 60%); border-color:#d7e7ff;">
              <div class="label">è³‡é‡‘å–å›ç¸½é¡</div>
              <div class="hero-number blue">NT$ <span id="sHeroNet">-</span> å…ƒ</div>
              <div class="hero-note">
                æŒæœ‰æœŸé–“ï¼š<span id="sYears">-</span> å¹´ |
                é©ç”¨ç¨…ç‡ï¼š<span id="sRate">-</span>
                <div id="sBadge" class="badge hidden" style="margin-top:6px;">âœ“ ç¬¦åˆè‡ªä½å„ªæƒ æ¢ä»¶</div>
                <div id="sExempt" class="hidden" style="color:#0d7c68; font-weight:700; margin-top:6px;">å…ç¨…é¡åº¦ï¼šNT$ <span id="sExemptAmt"></span> å…ƒ</div>
              </div>
            </div>

            <!-- å››æ ¼ KPI -->
            <div class="kpi-grid">
              <div class="kpi"><div class="label">æˆäº¤ç¸½åƒ¹</div><div class="value" id="sSale">-</div></div>
              <div class="kpi"><div class="label">å‡ºå”®ç²åˆ©ï¼ˆèª²ç¨…æ‰€å¾—ï¼‰</div><div class="value" id="sTaxable">-</div></div>
              <div class="kpi"><div class="label">æˆ¿åœ°åˆä¸€ç¨…</div><div class="value" id="sCGT">-</div></div>
              <div class="kpi"><div class="label">ä»²ä»‹è²»</div><div class="value" id="sAgent">-</div></div>
            </div>
          </div>
        </section>
      </div>
    </div>

    <!-- ====== åˆ†é  3ï¼šæ™®ç‰¹çµ²ï¼ˆç´—çª—å ±åƒ¹å·¥å…·ï¼‰ ====== -->
    <div id="tabScreen" class="hidden">
      <section class="card">
        <h2><i class="bi bi-window" style="color:#ff7b54"></i> æ™®ç‰¹çµ²ç´—çª—å ±åƒ¹å·¥å…·</h2>

        <div class="section">
          <div class="toolbar">
            <button class="btn" id="btnAdd">â• æ–°å¢ä¸€æ‰‡ç´—çª—</button>
            <button class="btn dark" id="btnCalc">ğŸ“Š è¨ˆç®—ç¸½åƒ¹</button>
            <button class="btn secondary" id="btnSample">ğŸ“¥ è¼‰å…¥ç¯„ä¾‹</button>
            <button class="btn warn" id="btnClear">ğŸ§¹ æ¸…ç©ºå…¨éƒ¨</button>
          </div>

          <div class="table-wrap">
            <table>
              <thead>
                <tr>
                  <th>é¡å‹</th>
                  <th>é•·åº¦(cm)</th>
                  <th>å¯¬åº¦(cm)</th>
                  <th>æ•¸é‡</th>
                  <th>ä¸ˆé‡ä½ç½®</th>
                  <th>æ“ä½œ</th>
                </tr>
              </thead>
              <tbody id="rows"></tbody>
            </table>
          </div>

          <!-- ä¸€éµè¤‡è£½æŒ‰éˆ• -->
          <button class="btn copy" id="btnCopy">ğŸ“‹ ä¸€éµè¤‡è£½å ±åƒ¹å–®</button>
          <div class="quoteText" id="quoteText"></div>
        </div>
      </section>
    </div>
  </div>

  <!-- âœ… CTAï¼šä½å•†å®˜æ–¹å¸³è™Ÿï¼ˆå›ºå®šé¡¯ç¤ºæ–¼æ‰€æœ‰åˆ†é åº•éƒ¨ï¼‰ -->
  <div class="cta" aria-label="åŠ å…¥ LINE å®˜æ–¹å¸³è™Ÿï¼ˆå¯æ°´å¹³æ»‘å‹•ï¼‰">
    <a href="https://lin.ee/9GV0YQ1D" target="_blank" rel="noopener">
      <i class="fa-brands fa-line"></i>
      <span>ä½å•†æ¥Šæ¢…å¤§é †åº— - å­è²ã€æ¿¬ç‘’å®˜æ–¹å¸³è™Ÿ</span>
    </a>
    <div class="subtle">å°ˆæ¥­æˆ¿å±‹è²¸æ¬¾è«®è©¢æœå‹™ï¼Œæ­¡è¿åŠ å…¥ LINE æ´½è©¢</div>
  </div>

  <script>
    /* ==========================================================
       åˆ†é åˆ‡æ›ï¼šä¸‰å€‹æŒ‰éˆ•æ§åˆ¶ä¸‰å€‹å€å¡Šï¼ˆè²·/è³£/æ™®ç‰¹çµ²ï¼‰
       ========================================================== */
    const $ = s => document.querySelector(s);
    const $$ = s => document.querySelectorAll(s);

    const btnTabBuyer  = $('#btnTabBuyer');
    const btnTabSeller = $('#btnTabSeller');
    const btnTabScreen = $('#btnTabScreen');

    const tabBuyer  = $('#tabBuyer');
    const tabSeller = $('#tabSeller');
    const tabScreen = $('#tabScreen');

    function setActive(tab){
      [tabBuyer, tabSeller, tabScreen].forEach(el => el.classList.add('hidden'));
      [btnTabBuyer, btnTabSeller, btnTabScreen].forEach(btn => btn.setAttribute('aria-selected','false'));

      if(tab==='buyer'){ tabBuyer.classList.remove('hidden'); btnTabBuyer.setAttribute('aria-selected','true'); }
      if(tab==='seller'){ tabSeller.classList.remove('hidden'); btnTabSeller.setAttribute('aria-selected','true'); }
      if(tab==='screen'){ tabScreen.classList.remove('hidden'); btnTabScreen.setAttribute('aria-selected','true'); }

      // åˆ‡æ›æ™‚é‡ç½®å ä½ï¼ˆé¿å…èª¤æœƒï¼‰
      resetBuyerResults();
      resetSellerResults();
    }
    btnTabBuyer .addEventListener('click', ()=>setActive('buyer'));
    btnTabSeller.addEventListener('click', ()=>setActive('seller'));
    btnTabScreen.addEventListener('click', ()=>setActive('screen'));
    setActive('buyer'); // é è¨­

    // æŠ˜ç–Šé¢æ¿ï¼ˆé›œé …è²»ç”¨ï¼‰
    $$('.section-toggle').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const target = btn.getAttribute('data-target');
        document.querySelector(target).classList.toggle('hidden');
      });
    });

    /* ==========================
       è²·æ–¹è¨ˆç®—ï¼ˆå–®ä¸€æˆæ•¸ 30~85ï¼‰
       ========================== */
    const nf = new Intl.NumberFormat('zh-TW');
    const fmt = n => nf.format(Math.round(n ?? 0));

    function calcBuyerLoan(priceWan, ratio, loanYears, interestRate, graceYears, misc){
      const priceNT = parseFloat(priceWan) * 10000;
      const loanAmount = priceNT * (parseFloat(ratio)/100);
      const downPayment = priceNT - loanAmount;

      const totalMisc = Object.values(misc).reduce((s,v)=> s + (parseFloat(v)||0), 0);
      const totalDown = downPayment + totalMisc;

      const monthlyRate = parseFloat(interestRate)/100/12;
      const totalMonths = parseInt(loanYears)*12;
      const graceMonths = parseInt(graceYears)||0;

      let monthlyPayment = 0;
      if(totalMonths > 0){
        if(monthlyRate>0){
          const pow = Math.pow(1+monthlyRate, totalMonths);
          monthlyPayment = loanAmount * monthlyRate * pow / (pow - 1);
        }else{
          monthlyPayment = loanAmount / totalMonths;
        }
      }else{
        // å¹´æœŸ=0ï¼šä¸æ”¤é‚„ï¼Œåƒ…è¨ˆå¯¬é™æœŸåˆ©æ¯
        monthlyPayment = 0;
      }

      const gracePayment = loanAmount * monthlyRate;
      const interestFromAmort = totalMonths > 0 ? (monthlyPayment * (totalMonths - graceMonths)) - loanAmount : 0;
      const interestFromGrace = gracePayment * graceMonths;
      const totalInterest = Math.max(0, interestFromAmort) + interestFromGrace;
      const totalRepayment = loanAmount + totalInterest;

      return {
        loanAmount: loanAmount/10000,
        downPayment: downPayment/10000,
        totalDownPayment: totalDown/10000,
        totalMiscFees: totalMisc/10000,
        monthlyPayment: Math.round(monthlyPayment),
        gracePayment: Math.round(gracePayment),
        totalInterest: totalInterest/10000,
        totalRepayment: totalRepayment/10000
      };
    }

    function resetBuyerResults(){
      $('#placeholderBuyer').classList.remove('hidden');
      $('#buyerResults').classList.add('hidden');
    }

    $('#btnClearBuyer').addEventListener('click', ()=>{
      $('#formBuyer').reset();
      $('#bLoanRatio').value = 80;
      $('#bLoanYears').value = 30;
      $('#bInterest').value = 2.1;
      $('#bGraceYears').value = 0;
      $('#buyerMisc').classList.add('hidden');
      resetBuyerResults();
    });

    $('#btnCalcBuyer').addEventListener('click', ()=>{
      const priceWan = parseFloat($('#bHousePrice').value);
      const ratio = parseFloat($('#bLoanRatio').value);
      const loanYears = parseInt($('#bLoanYears').value);
      const interest = $('#bInterest').value;
      const graceYears = parseInt($('#bGraceYears').value) || 0;

      // ç¯„åœé©—è­‰
      if(!priceWan || priceWan<=0){ alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æˆ¿å±‹ç¸½åƒ¹'); return; }
      if(isNaN(ratio) || ratio < 30 || ratio > 85){ alert('è²¸æ¬¾æˆæ•¸å¿…é ˆåœ¨ 30 ~ 85 ä¹‹é–“'); return; }
      if(isNaN(loanYears) || loanYears < 0 || loanYears > 40){ alert('è²¸æ¬¾å¹´æœŸå¿…é ˆåœ¨ 0 ~ 40 å¹´ä¹‹é–“'); return; }
      if(isNaN(graceYears) || graceYears < 0 || graceYears > 5){ alert('å¯¬é™æœŸå¿…é ˆåœ¨ 0 ~ 5 å¹´ä¹‹é–“'); return; }

      const result = calcBuyerLoan(priceWan, ratio, loanYears, interest, graceYears, {
        serviceFee: $('#bServiceFee').value,
        notaryFee: $('#bNotaryFee').value,
        agentFee: $('#bAgentFee').value,
        contractTax: $('#bContractTax').value,
        registrationFee: $('#bRegFee').value,
        insurance: $('#bInsurance').value
      });

      // KPI
      $('#bHeroDown').textContent = fmt(result.totalDownPayment*10000);
      $('#bHeroLoan').textContent  = fmt(result.loanAmount*10000);

      // æ˜ç´°å¡
      const grid = $('#bDetailGrid');
      grid.innerHTML = `
        <div class="kpi">
          <div class="label"><strong>${ratio}æˆè²¸æ¬¾</strong></div>
          <div class="value" style="font-size:16px;">
            ç¸½è‡ªå‚™æ¬¾ï¼šNT$ ${fmt(result.totalDownPayment*10000)}<br>
            è²¸æ¬¾é‡‘é¡ï¼šNT$ ${fmt(result.loanAmount*10000)}<br>
            æ¯æœˆé‚„æ¬¾ï¼šNT$ ${fmt(result.monthlyPayment)}<br>
            å¯¬é™æœŸæœˆä»˜ï¼šNT$ ${fmt(result.gracePayment)}<br>
            ç¸½åˆ©æ¯ï¼šNT$ ${fmt(result.totalInterest*10000)}<br>
            ç¸½é‚„æ¬¾é‡‘é¡ï¼šNT$ ${fmt(result.totalRepayment*10000)}
          </div>
        </div>`;

      // é¡¯ç¤ºåˆ‡æ›
      $('#placeholderBuyer').classList.add('hidden');
      $('#buyerResults').classList.remove('hidden');
    });

    /* ==========================
       è³£æ–¹è¨ˆç®—ï¼ˆæˆ¿åœ°åˆä¸€ç¨… 2.0ï¼‰
       ========================== */
    function resetSellerResults(){
      $('#placeholderSeller').classList.remove('hidden');
      $('#sellerResults').classList.add('hidden');
    }

    $('#btnClearSeller').addEventListener('click', ()=>{
      $('#formSeller').reset();
      $('#sAgentRate').value = 2;
      $('#sNotary').value = 15000;
      $('#sellerMisc').classList.add('hidden');
      resetSellerResults();
    });

    function runSeller(){
      const saleWan = parseFloat($('#sSalePrice').value);
      const purchaseWan = parseFloat($('#sPurchasePrice').value);
      const pDate = $('#sPurchaseDate').value;
      const sDate = $('#sSaleDate').value;

      if(!saleWan || !purchaseWan || !pDate || !sDate){ alert('è«‹å¡«å…¥æ‰€æœ‰å¿…è¦è³‡è¨Š'); return; }

      const salePrice = saleWan * 10000;
      const purchasePrice = purchaseWan * 10000;
      const holdingYears = (new Date(sDate) - new Date(pDate)) / (1000*60*60*24*365);

      const isOwner = $('#sOwner').checked;
      const hasResi = $('#sResidence').checked;
      const rentedOrBiz = $('#sRented').checked;

      const improve = parseFloat($('#sImprove').value)||0;
      const lvi = parseFloat($('#sLVI').value)||0;
      const agentRate = parseFloat($('#sAgentRate').value)||0;
      const agentFee = salePrice * (agentRate/100);
      const notary = parseFloat($('#sNotary').value)||0;
      const contract = parseFloat($('#sContract').value)||0;
      const stamp = parseFloat($('#sStamp').value)||0;
      const cert = parseFloat($('#sCert').value)||0;
      const payoff = parseFloat($('#sPayoff').value)||0;
      const other = parseFloat($('#sOther').value)||0;

      const relatedFees = agentFee + notary + contract + stamp + cert + improve;
      const taxable = salePrice - purchasePrice - relatedFees - lvi;

      const qualify = isOwner && hasResi && !rentedOrBiz && holdingYears >= 6;
      let taxRate = 0, cgt = 0, exemptAmt = 0;
      if(qualify){
        if(taxable <= 4_000_000){ cgt = 0; taxRate = 0; exemptAmt = Math.max(0, taxable); }
        else{ cgt = (taxable - 4_000_000) * 0.10; taxRate = 0.10; exemptAmt = 4_000_000; }
      }else{
        if(holdingYears < 2) taxRate = 0.45;
        else if(holdingYears < 5) taxRate = 0.35;
        else if(holdingYears < 10) taxRate = 0.20;
        else taxRate = 0.15;
        cgt = Math.max(0, taxable * taxRate);
      }

      const totalFees = agentFee + notary + contract + stamp + cert + payoff + other + cgt;
      const net = salePrice - totalFees;

      // KPI
      $('#sHeroNet').textContent = fmt(net);
      $('#sYears').textContent = (holdingYears).toFixed(1);
      $('#sRate').textContent = (taxRate*100).toFixed(0) + '%';
      if(qualify){ $('#sBadge').classList.remove('hidden'); } else { $('#sBadge').classList.add('hidden'); }
      if(exemptAmt>0){ $('#sExempt').classList.remove('hidden'); $('#sExemptAmt').textContent = fmt(exemptAmt); }
      else{ $('#sExempt').classList.add('hidden'); }

      // å°å¡
      $('#sSale').textContent = 'NT$ ' + fmt(salePrice);
      $('#sTaxable').textContent = 'NT$ ' + fmt(taxable);
      $('#sCGT').textContent = 'NT$ ' + fmt(cgt);
      $('#sAgent').textContent = 'NT$ ' + fmt(agentFee);

      // é¡¯ç¤ºåˆ‡æ›
      $('#placeholderSeller').classList.add('hidden');
      $('#sellerResults').classList.remove('hidden');
    }
    $('#btnCalcSeller').addEventListener('click', runSeller);

    /* ==========================
       æ™®ç‰¹çµ²ï¼ˆç´—çª—å ±åƒ¹å·¥å…·ï¼‰
       ========================== */
    const rowsEl=document.getElementById("rows");
    const quoteText=document.getElementById("quoteText");

    function addRow(pref={type:'å¹³ç´—',length:'',width:'',qty:1,pos:''}){
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td><select><option value="å¹³ç´—"${pref.type==='å¹³ç´—'?' selected':''}>å¹³ç´—</option><option value="æ²ç´—"${pref.type==='æ²ç´—'?' selected':''}>æ²ç´—</option></select></td>
        <td><input type="number" value="${pref.length}" placeholder="é•·åº¦"></td>
        <td><input type="number" value="${pref.width}" placeholder="å¯¬åº¦"></td>
        <td><input type="number" value="${pref.qty}" min="1"></td>
        <td><input type="text" value="${pref.pos}" placeholder="è«‹è¼¸å…¥ä¸ˆé‡ä½ç½®"></td>
        <td><button class="btn warn">ç§»é™¤</button></td>`;
      tr.querySelector("button").onclick=()=>tr.remove();
      rowsEl.appendChild(tr);
    }
    function collectRows(){
      const arr=[];
      rowsEl.querySelectorAll("tr").forEach(tr=>{
        const type=tr.cells[0].querySelector("select").value;
        const len=parseFloat(tr.cells[1].querySelector("input").value)||0;
        const wid=parseFloat(tr.cells[2].querySelector("input").value)||0;
        const qty=parseInt(tr.cells[3].querySelector("input").value)||0;
        const pos=tr.cells[4].querySelector("input").value.trim();
        if(len>0&&wid>0&&qty>0) arr.push({type,length:len,width:wid,qty,pos});
      });
      return arr;
    }
    function calcQuote(rows){
      let details=[],totalTsai=0,totalPrice=0;
      rows.forEach(r=>{
        let tsai=(r.type==='å¹³ç´—')?((r.length+20)*(r.width+20))/900:(r.length*r.width)/900;
        tsai=Math.max(tsai,8);
        const tsaiTotal=tsai*r.qty;
        const unit=(r.type==='å¹³ç´—')?405:1205;
        const subtotal=tsaiTotal*unit;
        totalTsai+=tsaiTotal; totalPrice+=subtotal;
        details.push({...r,tsaiTotal,subtotal});
      });
      const labor=(totalTsai<50)?4500:totalTsai*90;
      const tax=(totalPrice+labor)*0.05;
      const final=Math.round(totalPrice+labor+tax);
      return{details,totalTsai,totalPrice,labor,tax,final};
    }
    function renderQuote(res){
      if(!res)return;
      const {details,totalTsai,totalPrice,labor,tax,final}=res;

      let txt="æ‚¨å¥½ï¼é€™æ˜¯æ‚¨çš„æ™®ç‰¹çµ²ç´—çª—å ±åƒ¹å–®ï¼Œè«‹æ‚¨åƒè€ƒï¼š\n\n";
      const pings=details.filter(d=>d.type==='å¹³ç´—');
      const juans=details.filter(d=>d.type==='æ²ç´—');
      if(pings.length){
        txt+="ğŸ“Œ å ±åƒ¹ç´°é …ï¼ˆå¹³ç´— ğŸªŸï¼‰ï¼š\n";
        pings.forEach(d=>{
          const showL=d.length+20, showW=d.width+20; // é¡¯ç¤º +20
          txt+=`${d.pos||''} ${d.type}ãƒ»${showL}Ã—${showW}ãƒ»${d.qty} å€‹ãƒ»${d.tsaiTotal.toFixed(2)} æ‰\n`;
        });
      }
      if(juans.length){
        txt+="\nğŸ“Œ å ±åƒ¹ç´°é …ï¼ˆæ²ç´— ğŸ¡ï¼‰ï¼š\n";
        juans.forEach(d=>{
          const showL=d.length+20, showW=d.width+20; // é¡¯ç¤ºä¹Ÿ +20
          txt+=`${d.pos||''} ${d.type}ãƒ»${showL}Ã—${showW}ãƒ»${d.qty} å€‹ãƒ»${d.tsaiTotal.toFixed(2)} æ‰\n`;
        });
      }
      txt+=`\nğŸ“Š ç¸½å…±æ‰æ•¸ï¼š${totalTsai.toFixed(2)} æ‰\n\n`;
      txt+=`ğŸ’° åƒ¹æ ¼éƒ¨åˆ†\n`;
      txt+=`ç´—ç¶²ææ–™è²»ï¼š${totalPrice.toFixed(0)} å…ƒ\n`;
      txt+=`æ²ç´—æ©Ÿæ§‹èˆ‡çƒ¤æ¼†è²»ï¼š0 å…ƒ\n`;
      txt+=`æ–½å·¥è²»ç”¨ï¼š${labor.toFixed(0)} å…ƒ\n`;
      txt+=`ç‡Ÿæ¥­ç¨…ï¼š${tax.toFixed(0)} å…ƒ\n`;
      txt+=`â”â”â”â”â”â”â”â”â”â”â”â”\n`;
      txt+=`ç¸½é‡‘é¡(å«ç¨…åŠæ–½å·¥)ï¼š${final} å…ƒ\n\n`;
      txt+=`ğŸ“Œ æ­¤å ±åƒ¹å·²å«ææ–™ã€ç¨…é‡‘èˆ‡æ–½å·¥è²»åŠå«è€—æ20å…¬åˆ†è¨ˆç®—ã€‚å¯¦éš›é‡‘é¡å°‡ä¾ç¾å ´ä¸ˆé‡èª¿æ•´ã€‚`;
      quoteText.textContent=txt;
    }

    // ç¶å®šç´—çª—å·¥å…·æŒ‰éˆ•
    $('#btnAdd').onclick=()=>addRow();
    $('#btnClear').onclick=()=>{rowsEl.innerHTML='';quoteText.textContent='';addRow();};
    $('#btnCalc').onclick=()=>{const rows=collectRows();if(!rows.length){alert("è«‹è¼¸å…¥è³‡æ–™");return;}renderQuote(calcQuote(rows));};
    $('#btnSample').onclick=()=>{rowsEl.innerHTML='';addRow({type:'å¹³ç´—',length:100,width:100,qty:1,pos:'å®¢å»³'});addRow({type:'æ²ç´—',length:200,width:150,qty:1,pos:'é™½å°'});};
    $('#btnCopy').onclick=()=>{const text=quoteText.textContent;if(!text.trim()){alert("è«‹å…ˆè¨ˆç®—å ±åƒ¹ï¼");return;}navigator.clipboard.writeText(text).then(()=>{alert("å ±åƒ¹å–®å·²è¤‡è£½ï¼Œå¯ä»¥ç›´æ¥è²¼åˆ° LINE / Messengerï¼");});};

    // åˆå§‹ä¸€åˆ—
    addRow();
  </script>
</body>
</html>
